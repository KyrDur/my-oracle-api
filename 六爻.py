import sys

class ZengShanBuYiEngine:
    """
    ã€Šå¢åˆ åœæ˜“ã€‹å…¨æœ¬æ¶æ„ç‰ˆ - å®Œæ•´é›†æˆ64å¦æ•°æ®åº“
    """
    def __init__(self):
        self._init_hexagram_db()     # åˆå§‹åŒ–64å¦æ•°æ®åº“
        self._init_golden_mirror()   # åˆå§‹åŒ–é»„é‡‘ç­–æ€»æ–­
        self._init_six_gods()        # åˆå§‹åŒ–å…­ç¥æ„è±¡

    def _init_hexagram_db(self):
        # è¿™é‡Œå½•å…¥äº†å®Œæ•´çš„64å¦æ•°æ®
        self.hexagrams = {
            # === ä¹¾å®« ===
            "ä¹¾ä¸ºå¤©": {"nature": "å…­å†²", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šä¹¾è€…ï¼Œå¥ä¹Ÿã€‚çº¯é˜³ä¹‹è±¡ï¼Œåˆšå¥ä¸­æ­£ï¼Œè‡ªå¼ºä¸æ¯ã€‚", "tide": "é£é¾™åœ¨å¤©ï¼ˆæç››æœŸ/æ»¡æ½®ï¼‰"},
            "å¤©é£å§¤": {"nature": "ä¸€é˜´ç”Ÿ", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå§¤è€…ï¼Œé‡ä¹Ÿã€‚é£äº‘ç›¸æµï¼Œå¤©ä¸‹æœ‰é£ï¼Œä¸æœŸè€Œé‡ã€‚", "tide": "æš—æµæ¶ŒåŠ¨ï¼ˆæœºé‡æœŸ/é£é™©æ½œä¼ï¼‰"},
            "å¤©å±±é": {"nature": "äºŒé˜´ç”Ÿ", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šéè€…ï¼Œé€€ä¹Ÿã€‚é€€é¿éšå±…ï¼Œè¿œå®³å…»æ™¦ã€‚", "tide": "äº¢é¾™æœ‰æ‚”ï¼ˆé€€æ½®/éŸ¬å…‰å…»æ™¦ï¼‰"},
            "å¤©åœ°å¦": {"nature": "ä¸‰é˜´ç”Ÿ/å…­åˆ", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¦è€…ï¼Œå¡ä¹Ÿã€‚å¤©åœ°ä¸äº¤ï¼Œä¸‡ç‰©ä¸é€šã€‚", "tide": "å†°å°æ—¶åˆ»ï¼ˆé˜»éš”æœŸ/åœæ»ï¼‰"},
            "é£åœ°è§‚": {"nature": "å››é˜´ç”Ÿ", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè§‚è€…ï¼Œçœ‹ä¹Ÿã€‚é£è¡Œåœ°ä¸Šï¼Œä¸‡ç‰©å¯è§ã€‚", "tide": "é«˜å¡”ç­æœ›ï¼ˆè§‚å¯ŸæœŸ/å®¡è§†ï¼‰"},
            "å±±åœ°å‰¥": {"nature": "äº”é˜´ç”Ÿ", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå‰¥è€…ï¼Œè½ä¹Ÿã€‚ç¾¤é˜´å‰¥é˜³ï¼Œæ ¹åŸºåŠ¨æ‘‡ã€‚", "tide": "å¤§å¦å°†å€¾ï¼ˆé£æ§æœŸ/æ­¢æŸï¼‰"},
            "ç«åœ°æ™‹": {"nature": "æ¸¸é­‚", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ™‹è€…ï¼Œè¿›ä¹Ÿã€‚æ—¥å‡ºåœ°ä¸Šï¼Œå…‰æ˜ç››å¤§ã€‚", "tide": "æ—­æ—¥ä¸œå‡ï¼ˆæ˜¾ç°æœŸ/ä¸Šå‡ï¼‰"},
            "ç«å¤©å¤§æœ‰": {"nature": "å½’é­‚", "palace": "ä¹¾é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤§æœ‰è€…ï¼Œå®½ä¹Ÿã€‚é‡‘ç‰æ»¡å ‚ï¼Œæ—¥ä¸½ä¸­å¤©ã€‚", "tide": "ä¸°æ”¶æ—¶åˆ»ï¼ˆæ”¶è·æœŸ/å¯Œè¶³ï¼‰"},
            # === å…‘å®« ===
            "å…‘ä¸ºæ³½": {"nature": "å…­å†²", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå…‘è€…ï¼Œè¯´ä¹Ÿã€‚ä¸¤æ³½ç›¸è¿ï¼Œæ¶¦æ³½ä¸‡ç‰©ï¼Œäº¦ä¸»å£èˆŒã€‚", "tide": "æ¶Ÿæ¼ªæ¿€è¡ï¼ˆæ²Ÿé€šæœŸ/å–œæ‚¦/äº‰è®ºï¼‰"},
            "æ³½æ°´å›°": {"nature": "ä¸€é˜³ç”Ÿ/å…­åˆ", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå›°è€…ï¼Œå±ä¹Ÿã€‚æ³½æ— æ°´ï¼Œå›°è€Œä¸é€šã€‚", "tide": "æ¶¸è¾™ä¹‹é²‹ï¼ˆä½è°·æœŸ/èµ„æºæ¯ç«­ï¼‰"},
            "æ³½åœ°èƒ": {"nature": "äºŒé˜³ç”Ÿ", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šèƒè€…ï¼Œèšä¹Ÿã€‚é¾™äº‰è™æ–—ï¼Œä¸‡ç‰©èšé›†ã€‚", "tide": "ç™¾å·å½’æµ·ï¼ˆèšé›†æœŸ/æ•´åˆï¼‰"},
            "æ³½å±±å’¸": {"nature": "ä¸‰é˜³ç”Ÿ", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå’¸è€…ï¼Œæ„Ÿä¹Ÿã€‚å±±æ³½é€šæ°”ï¼Œè‡³è¯šæ„Ÿç¥ã€‚", "tide": "å¿ƒçµå…±æŒ¯ï¼ˆæ„Ÿåº”æœŸ/è¿æ¥ï¼‰"},
            "æ°´å±±è¹‡": {"nature": "å››é˜³ç”Ÿ", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè¹‡è€…ï¼Œéš¾ä¹Ÿã€‚å±±é«˜æ°´æ·±ï¼Œè¡Œè·¯è‰°éš¾ã€‚", "tide": "å¯¸æ­¥éš¾è¡Œï¼ˆéšœç¢æœŸ/åœé¡¿ï¼‰"},
            "åœ°å±±è°¦": {"nature": "äº”é˜³ç”Ÿ", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè°¦è€…ï¼Œé€€ä¹Ÿã€‚åœ°ä¸­æœ‰å±±ï¼Œå†…é«˜å¤–ä½ã€‚", "tide": "è™šæ€€è‹¥è°·ï¼ˆä½è°ƒæœŸ/è°¦è®©ï¼‰"},
            "é›·å±±å°è¿‡": {"nature": "æ¸¸é­‚", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå°è¿‡è€…ï¼Œè¿‡ä¹Ÿã€‚é£é¸Ÿé—éŸ³ï¼Œå®œä¸‹ä¸å®œä¸Šã€‚", "tide": "é£é¸Ÿä½æ—‹ï¼ˆè¿‡æ¸¡æœŸ/å°é”™ï¼‰"},
            "é›·æ³½å½’å¦¹": {"nature": "å½’é­‚", "palace": "å…‘é‡‘", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå½’å¦¹è€…ï¼Œç»ˆä¹Ÿã€‚æµ®äº‘è”½æ—¥ï¼Œæ‰€å½’éæ­£ã€‚", "tide": "é”™ä½é“¾æ¥ï¼ˆå†²åŠ¨æœŸ/ç»“å±€ï¼‰"},
            # === ç¦»å®« ===
            "ç¦»ä¸ºç«": {"nature": "å…­å†²", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šç¦»è€…ï¼Œä¸½ä¹Ÿã€‚é™„ä¸½äºç‰©ï¼Œå…‰æ˜ä¹‹è±¡ã€‚", "tide": "çƒˆç«ç‡åŸï¼ˆä¾é™„æœŸ/æ‰©æ•£ï¼‰"},
            "ç«å±±æ—…": {"nature": "ä¸€é˜´ç”Ÿ/å…­åˆ", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ—…è€…ï¼Œå®¢ä¹Ÿã€‚ä¾æ –ä»–ä¹¡ï¼Œé¸Ÿç„šå…¶å·¢ã€‚", "tide": "ç¾æ—…å¤©æ¶¯ï¼ˆæ¼‚æ³ŠæœŸ/ä¸å®‰ï¼‰"},
            "ç«é£é¼": {"nature": "äºŒé˜´ç”Ÿ", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šé¼è€…ï¼Œå®šä¹Ÿã€‚é©æ•…é¼æ–°ï¼Œå»æ—§ç”Ÿæ–°ã€‚", "tide": "é“¸é¼æ—¶åˆ»ï¼ˆç¡®ç«‹æœŸ/ç¨³å›ºï¼‰"},
            "ç«æ°´æœªæµ": {"nature": "ä¸‰é˜´ç”Ÿ", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæœªæµè€…ï¼Œå¤±ä¹Ÿã€‚é˜´é˜³å¤±ä½ï¼Œäº‹çŠ¹æœªæˆã€‚", "tide": "å½¼å²¸æœªè¾¾ï¼ˆæ··ä¹±æœŸ/é‡æ•´ï¼‰"},
            "å±±æ°´è’™": {"nature": "å››é˜´ç”Ÿ", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè’™è€…ï¼Œæ˜§ä¹Ÿã€‚å±±ä¸‹å‡ºæ³‰ï¼Œè¿·é€”ä¸çŸ¥ã€‚", "tide": "è¿·é›¾æ£®æ—ï¼ˆå¯è’™æœŸ/æœªçŸ¥ï¼‰"},
            "é£æ°´æ¶£": {"nature": "äº”é˜´ç”Ÿ", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ¶£è€…ï¼Œæ•£ä¹Ÿã€‚é£å¹æ°´æ•£ï¼Œä¹˜èˆŸæµæ¶‰ã€‚", "tide": "çƒŸæ¶ˆäº‘æ•£ï¼ˆç¦»æ•£æœŸ/è§£æ•£ï¼‰"},
            "å¤©æ°´è®¼": {"nature": "æ¸¸é­‚", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè®¼è€…ï¼Œè®ºä¹Ÿã€‚å¤©æ°´è¿è¡Œï¼Œå„æ‰§ä¸€è¯ã€‚", "tide": "å”‡æªèˆŒæˆ˜ï¼ˆäº‰æ‰§æœŸ/åˆ†æ­§ï¼‰"},
            "å¤©ç«åŒäºº": {"nature": "å½’é­‚", "palace": "ç¦»ç«", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šåŒäººè€…ï¼Œäº²ä¹Ÿã€‚äºŒäººåŒå¿ƒï¼Œå…¶åˆ©æ–­é‡‘ã€‚", "tide": "å¿—åŒé“åˆï¼ˆç»“ç›ŸæœŸ/åˆä½œï¼‰"},
            # === éœ‡å®« ===
            "éœ‡ä¸ºé›·": {"nature": "å…­å†²", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šéœ‡è€…ï¼ŒåŠ¨ä¹Ÿã€‚é›·æƒŠç™¾é‡Œï¼Œéœ‡æƒŠç™¾éª¸ã€‚", "tide": "æƒŠé›·ç‚¸å“ï¼ˆéœ‡åŠ¨æœŸ/çªå˜ï¼‰"},
            "é›·åœ°è±«": {"nature": "ä¸€é˜´ç”Ÿ/å…­åˆ", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè±«è€…ï¼Œæ‚¦ä¹Ÿã€‚é›·å‡ºåœ°å¥‹ï¼Œé¡ºæ—¶è€ŒåŠ¨ã€‚", "tide": "æ˜¥é›·å”¤é†’ï¼ˆå®‰ä¹æœŸ/èˆ’é€‚åŒºï¼‰"},
            "é›·æ°´è§£": {"nature": "äºŒé˜´ç”Ÿ", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè§£è€…ï¼Œæ•£ä¹Ÿã€‚æ‚£éš¾é™¤å»ï¼Œå†°æ¶ˆç“¦è§£ã€‚", "tide": "å†°é›ªæ¶ˆèï¼ˆè§£è„±æœŸ/é‡Šæ€€ï¼‰"},
            "é›·é£æ’": {"nature": "ä¸‰é˜´ç”Ÿ", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ’è€…ï¼Œä¹…ä¹Ÿã€‚é•¿ä¹…ä¸å˜ï¼ŒæŒä¹‹ä»¥æ’ã€‚", "tide": "ç»†æ°´é•¿æµï¼ˆç¨³å®šæœŸ/æŒä¹…ï¼‰"},
            "åœ°é£å‡": {"nature": "å››é˜´ç”Ÿ", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå‡è€…ï¼Œè¿›ä¹Ÿã€‚æœ¨ç”Ÿäºåœ°ï¼Œæ—¶è‡³è€Œé•¿ã€‚", "tide": "è§é¾™åœ¨ç”°ï¼ˆæ”€å‡æœŸ/ç¨³è¿›ï¼‰"},
            "æ°´é£äº•": {"nature": "äº”é˜´ç”Ÿ", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šäº•è€…ï¼Œé™ä¹Ÿã€‚äº•å…»ä¸ç©·ï¼Œå®‰èº«ç«‹å‘½ã€‚", "tide": "æ·±äº•æ±²æ°´ï¼ˆä¿®æ•´æœŸ/å±€é™ï¼‰"},
            "æ³½é£å¤§è¿‡": {"nature": "æ¸¸é­‚", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤§è¿‡è€…ï¼Œç¥¸ä¹Ÿã€‚æ ‹æ¡¡ä¹‹è±¡ï¼Œæœ¬æœ«å¤ªå¼±ã€‚", "tide": "ç‹¬æœ¨éš¾æ”¯ï¼ˆè¶…è´Ÿè·æœŸ/å‹åŠ›ï¼‰"},
            "æ³½é›·éš": {"nature": "å½’é­‚", "palace": "éœ‡æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šéšè€…ï¼Œé¡ºä¹Ÿã€‚éšæ³¢é€æµï¼Œéšæ—¶å˜é€šã€‚", "tide": "éšæ³¢é€æµï¼ˆè·ŸéšæœŸ/é€‚åº”ï¼‰"},
            # === å·½å®« ===
            "å·½ä¸ºé£": {"nature": "å…­å†²", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå·½è€…ï¼Œå…¥ä¹Ÿã€‚é£è¡Œè‰åƒï¼Œè¿›é€€ä¸æœã€‚", "tide": "æŸ³çµ®éšé£ï¼ˆæ‘‡æ‘†æœŸ/æ¸—é€ï¼‰"},
            "é£å¤©å°ç•œ": {"nature": "ä¸€é˜´ç”Ÿ", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå°ç•œè€…ï¼Œå¡ä¹Ÿã€‚å¯†äº‘ä¸é›¨ï¼Œè‡ªæˆ‘å‹æŠ‘ã€‚", "tide": "é˜´äº‘ç§¯è“„ï¼ˆå‹æŠ‘æœŸ/å°æˆï¼‰"},
            "é£ç«å®¶äºº": {"nature": "äºŒé˜´ç”Ÿ", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå®¶äººè€…ï¼ŒåŒä¹Ÿã€‚å…¥æˆ·è§äººï¼Œå¼€èŠ±ç»“å­ã€‚", "tide": "ç¯ç«å¯äº²ï¼ˆå»ºè®¾æœŸ/å›å½’ï¼‰"},
            "é£é›·ç›Š": {"nature": "ä¸‰é˜´ç”Ÿ", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šç›Šè€…ï¼Œå¢ä¹Ÿã€‚æŸä¸Šç›Šä¸‹ï¼Œæ°”è¿äº¨é€šã€‚", "tide": "é¡ºé£æ»¡å¸†ï¼ˆå¢ç›ŠæœŸ/çº¢åˆ©ï¼‰"},
            "å¤©é›·æ— å¦„": {"nature": "å››é˜´ç”Ÿ/å…­å†²", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ— å¦„è€…ï¼ŒçœŸä¹Ÿã€‚çŸ³ä¸­è•´ç‰ï¼Œå®ˆçœŸæ— ç¥¸ã€‚", "tide": "æ„å¤–ä¹‹å±€ï¼ˆè¢«åŠ¨æœŸ/çªå‘ï¼‰"},
            "ç«é›·å™¬å—‘": {"nature": "äº”é˜´ç”Ÿ", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå™¬å—‘è€…ï¼Œåˆä¹Ÿã€‚é¢ä¸­æœ‰ç‰©ï¼Œå¿…é¡»å’¬æ–­ã€‚", "tide": "é“é½¿é“œç‰™ï¼ˆç£¨åˆæœŸ/äº‰ç«¯ï¼‰"},
            "å±±é›·é¢": {"nature": "æ¸¸é­‚", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šé¢è€…ï¼Œå…»ä¹Ÿã€‚å£èˆŒä¹‹è±¡ï¼Œè°¨è¨€æ…é£Ÿã€‚", "tide": "ä¼‘å…»ç”Ÿæ¯ï¼ˆä¿å…»æœŸ/ååï¼‰"},
            "å±±é£è›Š": {"nature": "å½’é­‚", "palace": "å·½æœ¨", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè›Šè€…ï¼Œåä¹Ÿã€‚å™¨çš¿ç”Ÿè™«ï¼Œäº‹ä¹…ç”Ÿè…ã€‚", "tide": "åˆ®éª¨ç–—æ¯’ï¼ˆæ•´é¡¿æœŸ/ä¿®å¤ï¼‰"},
            # === åå®« ===
            "åä¸ºæ°´": {"nature": "å…­å†²", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šåè€…ï¼Œé™·ä¹Ÿã€‚é‡é‡é™©é™·ï¼Œå¿ƒæ€€å¿§è™‘ã€‚", "tide": "æ¿€æµæ—‹æ¶¡ï¼ˆé™©é˜»æœŸ/è‡³æš—ï¼‰"},
            "æ°´æ³½èŠ‚": {"nature": "ä¸€é˜³ç”Ÿ", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šèŠ‚è€…ï¼Œæ­¢ä¹Ÿã€‚æ³½ä¸Šæœ‰æ°´ï¼Œå®œå®ˆèŠ‚åº¦ã€‚", "tide": "ä¿®ç­‘å ¤åï¼ˆèŠ‚åˆ¶æœŸ/ç«‹è§„ï¼‰"},
            "æ°´é›·å±¯": {"nature": "äºŒé˜³ç”Ÿ", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå±¯è€…ï¼Œéš¾ä¹Ÿã€‚ä¸‡ç‰©å§‹ç”Ÿï¼Œå¦‚è‹—åœ¨åœ°ã€‚", "tide": "ç ´åœŸèŒèŠ½ï¼ˆåˆ›ä¸šæœŸ/è‰°éš¾ï¼‰"},
            "æ°´ç«æ—¢æµ": {"nature": "ä¸‰é˜³ç”Ÿ", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ—¢æµè€…ï¼Œæˆä¹Ÿã€‚æ°´ç«ç›¸äº¤ï¼ŒåŠŸå¾·åœ†æ»¡ã€‚", "tide": "å®Œç¾å¹³è¡¡ï¼ˆå®ŒæˆæœŸ/å·…å³°ï¼‰"},
            "æ³½ç«é©": {"nature": "å››é˜³ç”Ÿ", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šé©è€…ï¼Œå˜ä¹Ÿã€‚æ°´ç«ç›¸æ¯ï¼Œæ—§åˆ¶å½“æ”¹ã€‚", "tide": "æµ´ç«é‡ç”Ÿï¼ˆå˜é©æœŸ/è½¬å‹ï¼‰"},
            "é›·ç«ä¸°": {"nature": "äº”é˜³ç”Ÿ", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šä¸°è€…ï¼Œå¤§ä¹Ÿã€‚æ—¥ä¸­åˆ™ç§»ï¼Œç››å¤§ä¹‹æã€‚", "tide": "çƒˆç«çƒ¹æ²¹ï¼ˆæç››æœŸ/é«˜å…‰ï¼‰"},
            "åœ°ç«æ˜å¤·": {"nature": "æ¸¸é­‚", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ˜å¤·è€…ï¼Œä¼¤ä¹Ÿã€‚æ—¥å…¥åœ°ä¸­ï¼Œå…‰æ˜å—æŸã€‚", "tide": "é»‘å¤œæ½œè¡Œï¼ˆå—æŒ«æœŸ/éšå¿ï¼‰"},
            "åœ°æ°´å¸ˆ": {"nature": "å½’é­‚", "palace": "åæ°´", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¸ˆè€…ï¼Œä¼—ä¹Ÿã€‚åœ°ä¸­æœ‰æ°´ï¼Œèšä¼—å…´å¸ˆã€‚", "tide": "æ•´å†›ç»æ­¦ï¼ˆåŠ¨å‘˜æœŸ/ç«äº‰ï¼‰"},
            # === è‰®å®« ===
            "è‰®ä¸ºå±±": {"nature": "å…­å†²", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè‰®è€…ï¼Œæ­¢ä¹Ÿã€‚é‡å±±åœ¨å¤–ï¼Œæ­¢å…¶æ‰€æ­¢ã€‚", "tide": "é«˜å±±ä»°æ­¢ï¼ˆé™æ­¢æœŸ/æš‚åœï¼‰"},
            "å±±ç«è´²": {"nature": "ä¸€é˜³ç”Ÿ/å…­åˆ", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šè´²è€…ï¼Œé¥°ä¹Ÿã€‚æ–‡é¥°å…‰å½©ï¼Œè™šæœ‰å…¶è¡¨ã€‚", "tide": "æ™šéœä½™æ™–ï¼ˆè£…é¥°æœŸ/å½¢è±¡ï¼‰"},
            "å±±å¤©å¤§ç•œ": {"nature": "äºŒé˜³ç”Ÿ", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤§ç•œè€…ï¼Œç§¯ä¹Ÿã€‚ç§¯èšæ‰å¾·ï¼Œå¤§æœ‰æ‰€ç§¯ã€‚", "tide": "ç²®ä»“æ»¡æº¢ï¼ˆç§¯è“„æœŸ/å‚¨å¤‡ï¼‰"},
            "å±±æ³½æŸ": {"nature": "ä¸‰é˜³ç”Ÿ", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæŸè€…ï¼Œå‡ä¹Ÿã€‚æŸä¸‹ç›Šä¸Šï¼Œå…ˆå¤±åå¾—ã€‚", "tide": "å‰ªæä¿®å‰ªï¼ˆä»˜å‡ºæœŸ/æ–­èˆç¦»ï¼‰"},
            "ç«æ³½ç½": {"nature": "å››é˜³ç”Ÿ", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šç½è€…ï¼Œå¼‚ä¹Ÿã€‚äºŒå¥³åŒå±…ï¼Œå…¶å¿—ä¸åŒã€‚", "tide": "åˆ†é“æ‰¬é•³ï¼ˆçŸ›ç›¾æœŸ/åˆ†æ­§ï¼‰"},
            "å¤©æ³½å±¥": {"nature": "äº”é˜³ç”Ÿ", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå±¥è€…ï¼Œç¤¼ä¹Ÿã€‚å¦‚å±¥è™å°¾ï¼Œå°å¿ƒè¡Œäº‹ã€‚", "tide": "è–„å†°ç‹¬è¡Œï¼ˆè°¨æ…æœŸ/è¯•æ¢ï¼‰"},
            "é£æ³½ä¸­å­š": {"nature": "æ¸¸é­‚", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šä¸­å­šè€…ï¼Œä¿¡ä¹Ÿã€‚é£å¹æ°´é¢ï¼Œè¯šä¿¡ä¸ºæœ¬ã€‚", "tide": "ä¿¡å®ˆæ‰¿è¯ºï¼ˆè¯šä¿¡æœŸ/å¥‘çº¦ï¼‰"},
            "é£å±±æ¸": {"nature": "å½’é­‚", "palace": "è‰®åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ¸è€…ï¼Œè¿›ä¹Ÿã€‚é«˜å±±æ¤æœ¨ï¼Œå¾ªåºæ¸è¿›ã€‚", "tide": "æ‹¾çº§è€Œä¸Šï¼ˆç¼“æ…¢å‘å±•æœŸ/æœ‰åºï¼‰"},
            # === å¤å®« ===
            "å¤ä¸ºåœ°": {"nature": "å…­å†²", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤è€…ï¼Œé¡ºä¹Ÿã€‚æŸ”é¡ºæ‰¿å¤©ï¼Œåšå¾·è½½ç‰©ã€‚", "tide": "å¤§åœ°æ²‰ç¡ï¼ˆåŒ…å®¹æœŸ/è¢«åŠ¨ï¼‰"},
            "åœ°é›·å¤": {"nature": "ä¸€é˜³ç”Ÿ/å…­åˆ", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤è€…ï¼Œåä¹Ÿã€‚ä¸€é˜³æ¥å¤ï¼Œä¸‡ç‰©æ›´ç”Ÿã€‚", "tide": "å†¬è‡³èŒèŠ½ï¼ˆé‡å¯æœŸ/å›å½’ï¼‰"},
            "åœ°æ³½ä¸´": {"nature": "äºŒé˜³ç”Ÿ", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šä¸´è€…ï¼Œå¤§ä¹Ÿã€‚ä»¥ä¸Šä¸´ä¸‹ï¼Œè‡³äºå…«æœˆæœ‰å‡¶ã€‚", "tide": "äº²ä¸´ç°åœºï¼ˆç®¡ç†æœŸ/é€¼è¿‘ï¼‰"},
            "åœ°å¤©æ³°": {"nature": "ä¸‰é˜³ç”Ÿ/å…­åˆ", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ³°è€…ï¼Œé€šä¹Ÿã€‚å°å¾€å¤§æ¥ï¼Œå¤©åœ°äº¤æ³°ã€‚", "tide": "ä¸‰é˜³å¼€æ³°ï¼ˆé€šç•…æœŸ/å’Œè°ï¼‰"},
            "é›·å¤©å¤§å£®": {"nature": "å››é˜³ç”Ÿ/å…­å†²", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤§å£®è€…ï¼Œå¿—ä¹Ÿã€‚é›·åœ¨å¤©ä¸Šï¼Œåˆšå£®å·²æã€‚", "tide": "åˆšæå¿…æŠ˜ï¼ˆå†²åˆºæœŸ/é²è½ï¼‰"},
            "æ³½å¤©å¤¬": {"nature": "äº”é˜³ç”Ÿ", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šå¤¬è€…ï¼Œå†³ä¹Ÿã€‚åˆšå†³æŸ”ä¹Ÿï¼Œå†³æ–­ä¹‹æ—¶ã€‚", "tide": "å½“æœºç«‹æ–­ï¼ˆå†³æˆ˜æœŸ/åˆ¤å†³ï¼‰"},
            "æ°´å¤©éœ€": {"nature": "æ¸¸é­‚", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šéœ€è€…ï¼Œå¾…ä¹Ÿã€‚äº‘ä¸Šäºå¤©ï¼Œé¥®é£Ÿå®´ä¹ã€‚", "tide": "å®ˆæ ªå¾…å…”ï¼ˆç­‰å¾…æœŸ/éœ€æ±‚ï¼‰"},
            "æ°´åœ°æ¯”": {"nature": "å½’é­‚", "palace": "å¤åœŸ", "quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ¯”è€…ï¼Œè¾…ä¹Ÿã€‚æ°´æ¯”äºåœ°ï¼Œç›¸äº²ç›¸è¾…ã€‚", "tide": "ä¼—æ˜Ÿæ‹±æœˆï¼ˆäº²å¯†æœŸ/é€‰æ‹©ï¼‰"},
        }

    def _init_golden_mirror(self):
        self.rules = {
            "æœˆç ´": {"quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæœˆç ´ä¹‹çˆ»ï¼Œè­¬ä¹‹æ¯æœ¨æœ½æ ªï¼Œé€¢ç”Ÿç”Ÿä¹‹ä¸èµ·ã€‚", "tide_meaning": "èƒ½é‡ç»“æ„çš„å´©å¡Œã€‚å°±åƒè¢«å·¨æµªæ‹ç¢çš„èˆ¹æ¿ï¼Œæš‚æ—¶å¤±å»äº†æ‰¿è½½åŠ›ã€‚"},
            "æ—¬ç©º": {"quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šç©ºè€…ï¼Œè™šä¹Ÿã€‚æ—ºä¸ä¸ºç©ºï¼ŒåŠ¨ä¸ä¸ºç©ºã€‚", "tide_meaning": "è¿·é›¾åŒºã€‚ç›®æ ‡å­˜åœ¨ï¼Œä½†ç›®å‰çœ‹ä¸è§æ‘¸ä¸ç€ï¼Œéœ€è¦ç­‰å¾…æ—¶é—´å¡«è¡¥çœŸç©ºã€‚"},
            "æš—åŠ¨": {"quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šæ—¥å»ºå†²é™çˆ»ï¼Œæ˜¯ä¸ºæš—åŠ¨ã€‚ç¦æ¥è€Œä¸çŸ¥ï¼Œç¥¸æ¥è€Œæœªè§‰ã€‚", "tide_meaning": "æ½œæµã€‚è¡¨é¢å¹³é™æ°´é¢ä¸‹æ¶ŒåŠ¨çš„åŠ›é‡ã€‚"},
            "åŒ–è¿›ç¥": {"quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šåŒ–è¿›ç¥è€…ï¼Œå¦‚æ˜¥æœ¨ä¹‹è£ï¼Œæœ‰æºä¹‹æ°´ï¼Œå¾—æ—¶å¾—åŠ¿ã€‚", "tide_meaning": "é¡ºé£æ¨æµªã€‚åŠ¿èƒ½æ­£åœ¨å±‚å±‚å åŠ ï¼Œäº‹æƒ…ä¼šè¶Šåšè¶Šå¤§ã€‚"},
            "åŒ–é€€ç¥": {"quote": "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šåŒ–é€€ç¥è€…ï¼Œå¦‚ç§‹èŠ±ä¹‹è°¢ï¼Œæ—¥è½è¥¿å±±ï¼Œæ¸å…¥é¢“åŠ¿ã€‚", "tide_meaning": "é€€æ½®æ—¶åˆ»ã€‚çƒ­åº¦æ­£åœ¨æ¶ˆé€€ï¼Œå»ºè®®è§å¥½å°±æ”¶ã€‚"},
        }

    def _init_six_gods(self):
        self.six_gods = {
            "é’é¾™": {"weather": "æ˜¥é£å’Œç…¦", "psycho": "å–œæ‚¦ã€åˆ›é€ ", "keyword": "ç”Ÿå‘"},
            "æœ±é›€": {"weather": "çƒˆæ—¥ç‡¥çƒ­", "psycho": "ç„¦è™‘ã€å£èˆŒ", "keyword": "å–§åš£"},
            "å‹¾é™ˆ": {"weather": "é˜´äº‘å¯†å¸ƒ", "psycho": "è¿Ÿç¼“ã€ç¨³é‡", "keyword": "åœæ»"},
            "è…¾è›‡": {"weather": "æ€ªé£é˜µé˜µ", "psycho": "æƒŠç–‘ã€æ•æ„Ÿ", "keyword": "ç¼ ç»•"},
            "ç™½è™": {"weather": "ç§‹é£è‚ƒæ€", "psycho": "å‹åŠ›ã€å†³æ–­", "keyword": "åˆšç¡¬"},
            "ç„æ­¦": {"weather": "æ°´é›¾è¿·è’™", "psycho": "è¿·èŒ«ã€éšç§˜", "keyword": "æ™¦æš—"}
        }

    def analyze(self, main_gua, var_gua, technical_tags, category="ä¸€èˆ¬"):
        base_info = self.hexagrams.get(main_gua, {"quote": "éœ€æŸ¥é˜…å…¨è°±", "tide": "æœªçŸ¥ç›¸ä½"})
        rule_hits = []
        tide_adjustment = ""
        
        for tag in technical_tags:
            for rule_name, content in self.rules.items():
                if rule_name in tag:
                    rule_hits.append(f"**ã€{rule_name}ã€‘**ï¼š{content['quote']}\n   > *æ½®æ±è½¬è¯‘ï¼š* {content['tide_meaning']}")
            for god, info in self.six_gods.items():
                if god in tag:
                    tide_adjustment += f"\n   * **å¤©æ°”ç³»ç»Ÿï¼ˆ{god}ï¼‰ï¼š** {info['weather']}ã€‚å¿ƒç†å¤„äº{info['psycho']}çŠ¶æ€ã€‚"

        output = []
        output.append("### ã€ä¸€ã€‘ å¢åˆ å¤ç±å›å“")
        output.append(f"**æœ¬å¦ã€{main_gua}ã€‘ï¼š** {base_info.get('quote')}")
        if var_gua and var_gua != main_gua: output.append(f"**å˜å¦ã€{var_gua}ã€‘ï¼š** å˜åŒ–åçš„ç»“å±€æŒ‡å‘ã€‚")
        output.append("")
        output.append("### ã€äºŒã€‘ é»„é‡‘ç­–Â·æŠ€æœ¯å®¡è®¡")
        output.append("\n".join(rule_hits) if rule_hits else "å¦è±¡å¹³ç¨³ï¼Œæ— ç‰¹æ®Šå†²ç ´ç©ºäº¡ç»“æ„ï¼Œä»¥äº”è¡Œç”Ÿå…‹è®ºæˆè´¥ã€‚")
        output.append("")
        output.append("### ã€ä¸‰ã€‘ äººç”Ÿæ½®æ±å®šä½")
        output.append(f"**å½“å‰ç›¸ä½ï¼š** {base_info.get('tide')}")
        output.append(f"**å¿ƒç†èƒ½è§åº¦ï¼š** {tide_adjustment}")
        output.append("")
        output.append("### ã€å››ã€‘ åˆ†ç±»ä¸“é¡¹æŒ‡å¼•")
        output.append(self._category_advice(category, base_info.get("nature", ""), technical_tags))
        return "\n".join(output)

    def _category_advice(self, category, nature, tags):
        advice = ""
        is_broken, is_retreat, is_advance = any("æœˆç ´" in t or "ç©º" in t for t in tags), "åŒ–é€€" in tags, "åŒ–è¿›" in tags
        if category == "äº‹ä¸š":
            advice = "ã€Šå¢åˆ åœæ˜“Â·æ±‚åç« ã€‹ï¼šâ€˜å®˜é¬¼æŒä¸–è¦æ—ºç›¸ã€‚â€™ " + ("åŠ¿èƒ½å‘ä¸Šå®œè¿›å–ã€‚" if is_advance else "åŠ¿èƒ½è¡°é€€å®œå®ˆæˆã€‚" if is_retreat else "æ ¹åŸºå—æŸå‹¿å¦„åŠ¨ã€‚" if is_broken else "éœ€è¯¦æŸ¥äº”è¡Œæ—ºè¡°ã€‚")
        elif category == "æ±‚è´¢":
            advice = "ã€Šå¢åˆ åœæ˜“Â·æ±‚è´¢ç« ã€‹ï¼šâ€˜è´¢æ—ºç¦å…´çš†å‰ã€‚â€™ " + ("å…­å†²å¦è´¢æ¥è´¢å»ä¸èšã€‚" if "å…­å†²" in nature else "èµ„é‡‘é“¾ææœ‰æ–­è£‚ã€‚" if is_broken else "å…³é”®çœ‹å¦»è´¢ä¸å­å­™åŠ›åº¦ã€‚")
        elif category == "æ„Ÿæƒ…":
            advice = "ã€Šå¢åˆ åœæ˜“Â·å©šå§»ç« ã€‹ï¼šâ€˜è´¢å®˜ä¸¤æ—ºï¼Œç´ç‘Ÿå’Œè°ã€‚â€™ " + ("å…­å†²ä¸»æ•£ï¼Œæ„Ÿæƒ…åŠ¨è¡ã€‚" if "å…­å†²" in nature else "å…­åˆè™½æœ‰æ³¢æŠ˜ç»ˆèƒ½å¤åˆã€‚" if "å…­åˆ" in nature else "")
        else:
            advice = "ã€Šå¢åˆ åœæ˜“ã€‹ï¼šâ€˜è¶‹å‰é¿å‡¶è€…ï¼ŒåŠ¡å¿…ç»†å¯Ÿç”¨ç¥ã€‚â€™"
        return advice

# ==========================================
# ğŸ‘‡ è¿™é‡Œæ˜¯ã€æ§åˆ¶å°ã€‘ï¼æƒ³ç®—ä»€ä¹ˆæ”¹è¿™é‡Œ ğŸ‘‡
# ==========================================
if __name__ == "__main__":
    
    # ğŸ“ åœ¨ä¸‹é¢ä¿®æ”¹ä½ è¦æµ‹çš„å†…å®¹ï¼š
    user_input = {
        "main_gua": "æ°´é›·å±¯",        # è¾“å…¥æœ¬å¦åå­—ï¼ˆå¿…é¡»åœ¨64å¦é‡Œï¼‰
        "var_gua": "æ°´æ³½èŠ‚",         # è¾“å…¥å˜å¦åå­—
        "technical_tags": ["æœ±é›€å‘åŠ¨", "æœˆç ´"], # æŠ€æœ¯æŒ‡æ ‡ï¼ˆæœˆç ´/æ—¬ç©º/åŒ–è¿›/åŒ–é€€/å…­ç¥ï¼‰
        "category": "äº‹ä¸š"           # é—®ä»€ä¹ˆï¼ˆäº‹ä¸š/æ±‚è´¢/æ„Ÿæƒ…ï¼‰
    }

    # å¯åŠ¨å¼•æ“
    print("\nğŸ”® æ­£åœ¨ç¿»é˜…ã€Šå¢åˆ åœæ˜“ã€‹...\n")
    engine = ZengShanBuYiEngine()
    print(engine.analyze(user_input["main_gua"], user_input["var_gua"], user_input["technical_tags"], user_input["category"]))